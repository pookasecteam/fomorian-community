{
  "_metadata": {
    "attack_id": "T1003.001",
    "variation": "001",
    "name": "ProcDump LSASS Dump",
    "description": "Sysinternals ProcDump used to create memory dump of LSASS",
    "expected_detection": "HIGH",
    "expected_soar": "credential-dumping-response",
    "kill_chain_phase": "credential-access",
    "notes": "Common pentester/red team technique. ProcDump is signed Microsoft binary. Generates both Sysmon and Windows Security logs.",
    "format": "wazuh-native",
    "format_version": "1.0"
  },
  "logs": [
    {
      "_comment": "Sysmon Event 1 - ProcDump execution",
      "sequence": 1,
      "timestamp": "",
      "log": {
        "timestamp": "",
        "rule": {
          "level": 12,
          "description": "Sysmon - Event 1: ProcDump LSASS Dump",
          "id": "100100",
          "mitre": {
            "id": [
              "T1003.001"
            ],
            "tactic": [
              "Credential Access"
            ],
            "technique": [
              "ProcDump LSASS Dump"
            ]
          },
          "firedtimes": 1,
          "mail": false,
          "groups": [
            "sysmon",
            "sysmon_event1",
            "windows"
          ]
        },
        "agent": {
          "id": "{{agent_id}}",
          "name": "{{agent_name}}",
          "ip": "10.1.0.20"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1700000000.584711511",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "1",
              "channel": "Microsoft-Windows-Sysmon/Operational",
              "providerName": "Microsoft-Windows-Sysmon",
              "computer": "{{hostname}}",
              "level": "4",
              "task": "1",
              "opcode": "0",
              "keywords": "0x8000000000000000",
              "severityValue": "INFORMATION"
            },
            "eventdata": {
              "utcTime": "{{utc_time}}",
              "processGuid": "{{guid}}",
              "processId": "{{pid}}",
              "image": "C:\\Tools\\procdump64.exe",
              "fileVersion": "10.11.0.0",
              "description": "Sysinternals process dump utility",
              "product": "ProcDump",
              "company": "Sysinternals - www.sysinternals.com",
              "originalFileName": "procdump.exe",
              "commandLine": "procdump64.exe -accepteula -ma lsass.exe C:\\Temp\\lsass.dmp",
              "currentDirectory": "C:\\Tools\\",
              "user": "{{domain_upper}}\\{{username}}",
              "integrityLevel": "High",
              "hashes": "SHA256=A7B2C3D4E5F6A7B8C9D0E1F2A3B4C5D6E7F8A9B0C1D2E3F4A5B6C7D8E9F0A1B2",
              "parentProcessGuid": "{{parent_guid}}",
              "parentProcessId": "{{parent_pid}}",
              "parentImage": "C:\\Windows\\System32\\cmd.exe",
              "parentCommandLine": "cmd.exe"
            }
          }
        }
      }
    },
    {
      "_comment": "Windows Security Event 4688 - ProcDump process creation",
      "sequence": 2,
      "timestamp": "",
      "log": {
        "timestamp": "",
        "rule": {
          "level": 12,
          "description": "Sysmon - Event 4688: ProcDump LSASS Dump",
          "id": "100100",
          "mitre": {
            "id": [
              "T1003.001"
            ],
            "tactic": [
              "Credential Access"
            ],
            "technique": [
              "ProcDump LSASS Dump"
            ]
          },
          "firedtimes": 1,
          "mail": false,
          "groups": [
            "sysmon",
            "sysmon_event4688",
            "windows"
          ]
        },
        "agent": {
          "id": "{{agent_id}}",
          "name": "{{agent_name}}",
          "ip": "10.1.0.20"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1700000000.73795201",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "4688",
              "channel": "Security",
              "providerName": "Microsoft-Windows-Security-Auditing",
              "computer": "{{hostname}}",
              "level": "4",
              "task": "1",
              "opcode": "0",
              "keywords": "0x8000000000000000",
              "severityValue": "INFORMATION"
            },
            "eventdata": {
              "subjectUserSid": "S-1-5-21-1234567890-1234567890-1234567890-500",
              "subjectUserName": "{{username}}",
              "subjectDomainName": "{{domain_upper}}",
              "subjectLogonId": "0x3E7",
              "newProcessId": "0x{{pid_hex}}",
              "newProcessName": "C:\\Tools\\procdump64.exe",
              "tokenElevationType": "%%1937",
              "processId": "0x{{parent_pid_hex}}",
              "commandLine": "procdump64.exe -accepteula -ma lsass.exe C:\\Temp\\lsass.dmp",
              "targetUserSid": "S-1-5-21-1234567890-1234567890-1234567890-500",
              "targetUserName": "{{username}}",
              "targetDomainName": "{{domain_upper}}",
              "targetLogonId": "0x3E7",
              "parentProcessName": "C:\\Windows\\System32\\cmd.exe",
              "mandatoryLabel": "S-1-16-12288"
            }
          }
        }
      }
    },
    {
      "_comment": "Sysmon Event 10 - Process Access to LSASS",
      "sequence": 3,
      "timestamp": "",
      "log": {
        "timestamp": "",
        "rule": {
          "level": 12,
          "description": "Sysmon - Event 10: ProcDump LSASS Dump",
          "id": "100100",
          "mitre": {
            "id": [
              "T1003.001"
            ],
            "tactic": [
              "Credential Access"
            ],
            "technique": [
              "ProcDump LSASS Dump"
            ]
          },
          "firedtimes": 1,
          "mail": false,
          "groups": [
            "sysmon",
            "sysmon_event10",
            "windows"
          ]
        },
        "agent": {
          "id": "{{agent_id}}",
          "name": "{{agent_name}}",
          "ip": "10.1.0.20"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1700000000.896612393",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "10",
              "channel": "Microsoft-Windows-Sysmon/Operational",
              "providerName": "Microsoft-Windows-Sysmon",
              "computer": "{{hostname}}",
              "level": "4",
              "task": "1",
              "opcode": "0",
              "keywords": "0x8000000000000000",
              "severityValue": "INFORMATION"
            },
            "eventdata": {
              "ruleName": "technique_id=T1003,technique_name=Credential Dumping",
              "utcTime": "{{utc_time}}",
              "sourceProcessGUID": "{{guid}}",
              "sourceProcessId": "{{pid}}",
              "sourceThreadId": "{{pid}}",
              "sourceImage": "C:\\Tools\\procdump64.exe",
              "targetProcessGUID": "{00000000-0000-0000-0000-000000000672}",
              "targetProcessId": "672",
              "targetImage": "C:\\Windows\\System32\\lsass.exe",
              "grantedAccess": "0x1FFFFF",
              "callTrace": "C:\\Windows\\SYSTEM32\\ntdll.dll+9d4c4|C:\\Windows\\System32\\KERNELBASE.dll+2bcce|C:\\Tools\\procdump64.exe+1a234",
              "sourceUser": "{{domain_upper}}\\{{username}}",
              "targetUser": "NT AUTHORITY\\SYSTEM"
            }
          }
        }
      }
    },
    {
      "_comment": "Windows Security Event 4663 - Object access (LSASS)",
      "sequence": 4,
      "timestamp": "",
      "log": {
        "timestamp": "",
        "rule": {
          "level": 12,
          "description": "Sysmon - Event 4663: ProcDump LSASS Dump",
          "id": "100100",
          "mitre": {
            "id": [
              "T1003.001"
            ],
            "tactic": [
              "Credential Access"
            ],
            "technique": [
              "ProcDump LSASS Dump"
            ]
          },
          "firedtimes": 1,
          "mail": false,
          "groups": [
            "sysmon",
            "sysmon_event4663",
            "windows"
          ]
        },
        "agent": {
          "id": "{{agent_id}}",
          "name": "{{agent_name}}",
          "ip": "10.1.0.20"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1700000000.228628530",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "4663",
              "channel": "Security",
              "providerName": "Microsoft-Windows-Security-Auditing",
              "computer": "{{hostname}}",
              "level": "4",
              "task": "1",
              "opcode": "0",
              "keywords": "0x8000000000000000",
              "severityValue": "INFORMATION"
            },
            "eventdata": {
              "subjectUserSid": "S-1-5-21-1234567890-1234567890-1234567890-500",
              "subjectUserName": "{{username}}",
              "subjectDomainName": "{{domain_upper}}",
              "subjectLogonId": "0x3E7",
              "objectServer": "Security",
              "objectType": "Process",
              "objectName": "\\Device\\HarddiskVolume2\\Windows\\System32\\lsass.exe",
              "handleId": "0x2a8",
              "accessList": "%%4416\n\t\t\t\t%%4432\n\t\t\t\t%%4423",
              "accessMask": "0x1FFFFF",
              "processId": "0x{{pid_hex}}",
              "processName": "C:\\Tools\\procdump64.exe"
            }
          }
        }
      }
    },
    {
      "_comment": "Sysmon Event 11 - Dump file created",
      "sequence": 5,
      "timestamp": "",
      "log": {
        "timestamp": "",
        "rule": {
          "level": 12,
          "description": "Sysmon - Event 11: ProcDump LSASS Dump",
          "id": "100100",
          "mitre": {
            "id": [
              "T1003.001"
            ],
            "tactic": [
              "Credential Access"
            ],
            "technique": [
              "ProcDump LSASS Dump"
            ]
          },
          "firedtimes": 1,
          "mail": false,
          "groups": [
            "sysmon",
            "sysmon_event11",
            "windows"
          ]
        },
        "agent": {
          "id": "{{agent_id}}",
          "name": "{{agent_name}}",
          "ip": "10.1.0.20"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1700000000.15685387",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "11",
              "channel": "Microsoft-Windows-Sysmon/Operational",
              "providerName": "Microsoft-Windows-Sysmon",
              "computer": "{{hostname}}",
              "level": "4",
              "task": "1",
              "opcode": "0",
              "keywords": "0x8000000000000000",
              "severityValue": "INFORMATION"
            },
            "eventdata": {
              "utcTime": "{{utc_time}}",
              "processGuid": "{{guid}}",
              "processId": "{{pid}}",
              "image": "C:\\Tools\\procdump64.exe",
              "targetFilename": "C:\\Temp\\lsass.dmp",
              "creationUtcTime": "{{utc_time}}",
              "user": "{{domain_upper}}\\{{username}}"
            }
          }
        }
      }
    }
  ]
}