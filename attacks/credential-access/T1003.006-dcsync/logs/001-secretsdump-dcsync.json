{
  "_metadata": {
    "attack_id": "T1003.006",
    "variation": "001",
    "name": "DCSync - Domain Controller Replication Abuse",
    "description": "Attacker uses impacket-secretsdump to replicate Active Directory credentials using DRSUAPI protocol, extracting all domain user password hashes including krbtgt",
    "expected_detection": "CRITICAL",
    "kill_chain_phase": "credential-access",
    "format": "wazuh-native",
    "format_version": "1.0",
    "tool": "impacket-secretsdump",
    "command": "impacket-secretsdump yourcompany.local/Administrator:\"pass\"@10.1.0.99 -just-dc",
    "impact": "Complete domain credential compromise - krbtgt hash enables Golden Ticket creation, all user NTLM hashes extracted for offline cracking"
  },
  "logs": [
    {
      "_comment": "Event 4662 - Directory Service Access (DRSUAPI DsGetNCChanges replication request)",
      "sequence": 1,
      "timestamp": "2026-02-10T23:15:00.000Z",
      "log": {
        "timestamp": "2026-02-10T23:15:00.000Z",
        "rule": {
          "level": 3,
          "description": "Windows Eventchannel event",
          "id": "60009",
          "firedtimes": 1,
          "mail": false,
          "groups": ["windows", "eventchannel"]
        },
        "agent": {
          "id": "012",
          "name": "DC01",
          "ip": "10.1.0.99"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1707600000.500001",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "4662",
              "channel": "Security",
              "providerName": "Microsoft-Windows-Security-Auditing",
              "computer": "DC01.yourcompany.local",
              "level": "0",
              "task": "14080",
              "keywords": "0x8020000000000000",
              "severityValue": "AUDIT_SUCCESS"
            },
            "eventdata": {
              "subjectUserSid": "S-1-5-21-3298120035-3471069779-879265153-500",
              "subjectUserName": "Administrator",
              "subjectDomainName": "YOURCOMPANY",
              "subjectLogonId": "0x12345",
              "objectServer": "DS",
              "objectType": "domainDNS",
              "objectName": "DC=yourcompany,DC=local",
              "handleId": "0x0",
              "accessList": "%%7688\n\t\t\t%%1131",
              "accessMask": "0x100",
              "properties": "{1131f6aa-9c07-11d1-f79f-00c04fc2dcd2}\n\t\t\t{1131f6ad-9c07-11d1-f79f-00c04fc2dcd2}\n\t\t\t{89e95b76-444d-4c62-991a-0facbeda640c}",
              "additionalInfo": "DS-Replication-Get-Changes\nDS-Replication-Get-Changes-All",
              "additionalInfo2": "CN=Domain Users,CN=Users,DC=yourcompany,DC=local"
            }
          }
        }
      }
    },
    {
      "_comment": "Event 4662 - Second replication request (DRS_GET_NC_CHANGES for krbtgt account)",
      "sequence": 2,
      "timestamp": "2026-02-10T23:15:01.000Z",
      "log": {
        "timestamp": "2026-02-10T23:15:01.000Z",
        "rule": {
          "level": 3,
          "description": "Windows Eventchannel event",
          "id": "60009",
          "firedtimes": 1,
          "mail": false,
          "groups": ["windows", "eventchannel"]
        },
        "agent": {
          "id": "012",
          "name": "DC01",
          "ip": "10.1.0.99"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1707600000.500002",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "4662",
              "channel": "Security",
              "providerName": "Microsoft-Windows-Security-Auditing",
              "computer": "DC01.yourcompany.local",
              "level": "0",
              "task": "14080",
              "keywords": "0x8020000000000000",
              "severityValue": "AUDIT_SUCCESS"
            },
            "eventdata": {
              "subjectUserSid": "S-1-5-21-3298120035-3471069779-879265153-500",
              "subjectUserName": "Administrator",
              "subjectDomainName": "YOURCOMPANY",
              "subjectLogonId": "0x12345",
              "objectServer": "DS",
              "objectType": "user",
              "objectName": "CN=krbtgt,CN=Users,DC=yourcompany,DC=local",
              "handleId": "0x0",
              "accessList": "%%7688\n\t\t\t%%1131",
              "accessMask": "0x100",
              "properties": "{1131f6aa-9c07-11d1-f79f-00c04fc2dcd2}\n\t\t\t{1131f6ad-9c07-11d1-f79f-00c04fc2dcd2}\n\t\t\t{89e95b76-444d-4c62-991a-0facbeda640c}",
              "additionalInfo": "DS-Replication-Get-Changes\nDS-Replication-Get-Changes-All",
              "additionalInfo2": "CN=krbtgt,CN=Users,DC=yourcompany,DC=local"
            }
          }
        }
      }
    },
    {
      "_comment": "Event 4662 - Mass replication request (entire domain partition)",
      "sequence": 3,
      "timestamp": "2026-02-10T23:15:02.000Z",
      "log": {
        "timestamp": "2026-02-10T23:15:02.000Z",
        "rule": {
          "level": 3,
          "description": "Windows Eventchannel event",
          "id": "60009",
          "firedtimes": 1,
          "mail": false,
          "groups": ["windows", "eventchannel"]
        },
        "agent": {
          "id": "012",
          "name": "DC01",
          "ip": "10.1.0.99"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1707600000.500003",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "4662",
              "channel": "Security",
              "providerName": "Microsoft-Windows-Security-Auditing",
              "computer": "DC01.yourcompany.local",
              "level": "0",
              "task": "14080",
              "keywords": "0x8020000000000000",
              "severityValue": "AUDIT_SUCCESS"
            },
            "eventdata": {
              "subjectUserSid": "S-1-5-21-3298120035-3471069779-879265153-500",
              "subjectUserName": "Administrator",
              "subjectDomainName": "YOURCOMPANY",
              "subjectLogonId": "0x12345",
              "objectServer": "DS",
              "objectType": "domainDNS",
              "objectName": "DC=yourcompany,DC=local",
              "handleId": "0x0",
              "accessList": "%%7688\n\t\t\t%%1131",
              "accessMask": "0x100",
              "properties": "{1131f6aa-9c07-11d1-f79f-00c04fc2dcd2}\n\t\t\t{1131f6ad-9c07-11d1-f79f-00c04fc2dcd2}\n\t\t\t{89e95b76-444d-4c62-991a-0facbeda640c}",
              "additionalInfo": "DS-Replication-Get-Changes\nDS-Replication-Get-Changes-All",
              "additionalInfo2": "CN=Users,DC=yourcompany,DC=local"
            }
          }
        }
      }
    }
  ]
}
