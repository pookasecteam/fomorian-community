{
  "_metadata": {
    "attack_id": "T1562.001",
    "variation": "001",
    "name": "Disable Windows Defender",
    "description": "Attacker disabling Windows Defender via PowerShell and registry",
    "expected_detection": "CRITICAL",
    "expected_soar": "defense-evasion-response",
    "kill_chain_phase": "defense-evasion",
    "notes": "Defense evasion technique - generates both Sysmon and Windows Security logs plus Defender-specific events",
    "format": "wazuh-native",
    "format_version": "1.0"
  },
  "logs": [
    {
      "_comment": "Sysmon Event 1 - PowerShell disabling Defender",
      "sequence": 1,
      "timestamp": "",
      "log": {
        "timestamp": "",
        "rule": {
          "level": 12,
          "description": "Sysmon - Event 1: Disable Windows Defender",
          "id": "100100",
          "mitre": {
            "id": [
              "T1562.001"
            ],
            "tactic": [
              "Defense Evasion"
            ],
            "technique": [
              "Disable Windows Defender"
            ]
          },
          "firedtimes": 1,
          "mail": false,
          "groups": [
            "sysmon",
            "sysmon_event1",
            "windows"
          ]
        },
        "agent": {
          "id": "{{agent_id}}",
          "name": "{{agent_name}}",
          "ip": "10.1.0.20"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1700000000.95895623",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "1",
              "channel": "Microsoft-Windows-Sysmon/Operational",
              "providerName": "Microsoft-Windows-Sysmon",
              "computer": "{{hostname}}",
              "level": "4",
              "task": "1",
              "opcode": "0",
              "keywords": "0x8000000000000000",
              "severityValue": "INFORMATION"
            },
            "eventdata": {
              "utcTime": "{{utc_time}}",
              "processGuid": "{{guid}}",
              "processId": "{{pid}}",
              "image": "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe",
              "commandLine": "powershell.exe -Command \"Set-MpPreference -DisableRealtimeMonitoring $true -DisableBehaviorMonitoring $true -DisableBlockAtFirstSeen $true\"",
              "currentDirectory": "C:\\Windows\\System32\\",
              "user": "{{domain_upper}}\\{{username}}",
              "integrityLevel": "High",
              "hashes": "SHA256=DE96A6E69944335375DC1AC238336066889D9FFC7D73628EF4FE1B1B160AB32C",
              "parentProcessGuid": "{{parent_guid}}",
              "parentProcessId": "{{parent_pid}}",
              "parentImage": "C:\\Windows\\System32\\cmd.exe",
              "parentCommandLine": "cmd.exe"
            }
          }
        }
      }
    },
    {
      "_comment": "Windows Security Event 4688 - PowerShell process creation",
      "sequence": 2,
      "timestamp": "",
      "log": {
        "timestamp": "",
        "rule": {
          "level": 12,
          "description": "Sysmon - Event 4688: Disable Windows Defender",
          "id": "100100",
          "mitre": {
            "id": [
              "T1562.001"
            ],
            "tactic": [
              "Defense Evasion"
            ],
            "technique": [
              "Disable Windows Defender"
            ]
          },
          "firedtimes": 1,
          "mail": false,
          "groups": [
            "sysmon",
            "sysmon_event4688",
            "windows"
          ]
        },
        "agent": {
          "id": "{{agent_id}}",
          "name": "{{agent_name}}",
          "ip": "10.1.0.20"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1700000000.98521832",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "4688",
              "channel": "Security",
              "providerName": "Microsoft-Windows-Security-Auditing",
              "computer": "{{hostname}}",
              "level": "4",
              "task": "1",
              "opcode": "0",
              "keywords": "0x8000000000000000",
              "severityValue": "INFORMATION"
            },
            "eventdata": {
              "subjectUserSid": "S-1-5-21-1234567890-1234567890-1234567890-500",
              "subjectUserName": "{{username}}",
              "subjectDomainName": "{{domain_upper}}",
              "subjectLogonId": "0x3E7",
              "newProcessId": "0x{{pid_hex}}",
              "newProcessName": "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe",
              "tokenElevationType": "%%1937",
              "processId": "0x{{parent_pid_hex}}",
              "commandLine": "powershell.exe -Command \"Set-MpPreference -DisableRealtimeMonitoring $true -DisableBehaviorMonitoring $true -DisableBlockAtFirstSeen $true\"",
              "targetUserSid": "S-1-5-21-1234567890-1234567890-1234567890-500",
              "targetUserName": "{{username}}",
              "targetDomainName": "{{domain_upper}}",
              "targetLogonId": "0x3E7",
              "parentProcessName": "C:\\Windows\\System32\\cmd.exe",
              "mandatoryLabel": "S-1-16-12288"
            }
          }
        }
      }
    },
    {
      "_comment": "PowerShell ScriptBlock logging - Defender disable",
      "sequence": 3,
      "timestamp": "",
      "log": {
        "timestamp": "",
        "rule": {
          "level": 12,
          "description": "Sysmon - Event 4104: Disable Windows Defender",
          "id": "100100",
          "mitre": {
            "id": [
              "T1562.001"
            ],
            "tactic": [
              "Defense Evasion"
            ],
            "technique": [
              "Disable Windows Defender"
            ]
          },
          "firedtimes": 1,
          "mail": false,
          "groups": [
            "sysmon",
            "sysmon_event4104",
            "windows"
          ]
        },
        "agent": {
          "id": "{{agent_id}}",
          "name": "{{agent_name}}",
          "ip": "10.1.0.20"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1700000000.763655810",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "4104",
              "channel": "Microsoft-Windows-PowerShell/Operational",
              "providerName": "Microsoft-Windows-PowerShell",
              "computer": "{{hostname}}",
              "level": "4",
              "task": "1",
              "opcode": "0",
              "keywords": "0x8000000000000000",
              "severityValue": "INFORMATION"
            },
            "eventdata": {
              "messageNumber": "1",
              "messageTotal": "1",
              "scriptBlockText": "Set-MpPreference -DisableRealtimeMonitoring $true -DisableBehaviorMonitoring $true -DisableBlockAtFirstSeen $true",
              "scriptBlockId": "def12345-6789-0abc-def1-234567890abc",
              "path": ""
            }
          }
        }
      }
    },
    {
      "_comment": "Sysmon Event 13 - Registry modification for Defender RealTimeMonitoring",
      "sequence": 4,
      "timestamp": "",
      "log": {
        "timestamp": "",
        "rule": {
          "level": 12,
          "description": "Sysmon - Event 13: Disable Windows Defender",
          "id": "100100",
          "mitre": {
            "id": [
              "T1562.001"
            ],
            "tactic": [
              "Defense Evasion"
            ],
            "technique": [
              "Disable Windows Defender"
            ]
          },
          "firedtimes": 1,
          "mail": false,
          "groups": [
            "sysmon",
            "sysmon_event13",
            "windows"
          ]
        },
        "agent": {
          "id": "{{agent_id}}",
          "name": "{{agent_name}}",
          "ip": "10.1.0.20"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1700000000.51994956",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "13",
              "channel": "Microsoft-Windows-Sysmon/Operational",
              "providerName": "Microsoft-Windows-Sysmon",
              "computer": "{{hostname}}",
              "level": "4",
              "task": "1",
              "opcode": "0",
              "keywords": "0x8000000000000000",
              "severityValue": "INFORMATION"
            },
            "eventdata": {
              "utcTime": "{{utc_time}}",
              "eventType": "SetValue",
              "processGuid": "{{guid}}",
              "processId": "{{pid}}",
              "image": "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe",
              "targetObject": "HKLM\\SOFTWARE\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableRealtimeMonitoring",
              "details": "DWORD (0x00000001)",
              "user": "{{domain_upper}}\\{{username}}"
            }
          }
        }
      }
    },
    {
      "_comment": "Sysmon Event 13 - Registry modification for Defender BehaviorMonitoring",
      "sequence": 5,
      "timestamp": "",
      "log": {
        "timestamp": "",
        "rule": {
          "level": 12,
          "description": "Sysmon - Event 13: Disable Windows Defender",
          "id": "100100",
          "mitre": {
            "id": [
              "T1562.001"
            ],
            "tactic": [
              "Defense Evasion"
            ],
            "technique": [
              "Disable Windows Defender"
            ]
          },
          "firedtimes": 1,
          "mail": false,
          "groups": [
            "sysmon",
            "sysmon_event13",
            "windows"
          ]
        },
        "agent": {
          "id": "{{agent_id}}",
          "name": "{{agent_name}}",
          "ip": "10.1.0.20"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1700000000.586315673",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "13",
              "channel": "Microsoft-Windows-Sysmon/Operational",
              "providerName": "Microsoft-Windows-Sysmon",
              "computer": "{{hostname}}",
              "level": "4",
              "task": "1",
              "opcode": "0",
              "keywords": "0x8000000000000000",
              "severityValue": "INFORMATION"
            },
            "eventdata": {
              "utcTime": "{{utc_time}}",
              "eventType": "SetValue",
              "processGuid": "{{guid}}",
              "processId": "{{pid}}",
              "image": "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe",
              "targetObject": "HKLM\\SOFTWARE\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableBehaviorMonitoring",
              "details": "DWORD (0x00000001)",
              "user": "{{domain_upper}}\\{{username}}"
            }
          }
        }
      }
    },
    {
      "_comment": "Windows Defender Event 5001 - Real-time protection disabled",
      "sequence": 6,
      "timestamp": "",
      "log": {
        "timestamp": "",
        "rule": {
          "level": 12,
          "description": "Sysmon - Event 5001: Disable Windows Defender",
          "id": "100100",
          "mitre": {
            "id": [
              "T1562.001"
            ],
            "tactic": [
              "Defense Evasion"
            ],
            "technique": [
              "Disable Windows Defender"
            ]
          },
          "firedtimes": 1,
          "mail": false,
          "groups": [
            "sysmon",
            "sysmon_event5001",
            "windows"
          ]
        },
        "agent": {
          "id": "{{agent_id}}",
          "name": "{{agent_name}}",
          "ip": "10.1.0.20"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1700000000.759138885",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "5001",
              "channel": "Microsoft-Windows-Windows Defender/Operational",
              "providerName": "Microsoft-Windows-Windows Defender",
              "computer": "{{hostname}}",
              "level": "4",
              "task": "1",
              "opcode": "0",
              "keywords": "0x8000000000000000",
              "severityValue": "INFORMATION"
            },
            "eventdata": {
              "new Value": "0x0",
              "old Value": "0x1",
              "product Name": "Microsoft Defender Antivirus",
              "product Version": "4.18.2104.14"
            }
          }
        }
      }
    },
    {
      "_comment": "Sysmon Event 1 - sc.exe stopping Defender service",
      "sequence": 7,
      "timestamp": "",
      "log": {
        "timestamp": "",
        "rule": {
          "level": 12,
          "description": "Sysmon - Event 1: Disable Windows Defender",
          "id": "100100",
          "mitre": {
            "id": [
              "T1562.001"
            ],
            "tactic": [
              "Defense Evasion"
            ],
            "technique": [
              "Disable Windows Defender"
            ]
          },
          "firedtimes": 1,
          "mail": false,
          "groups": [
            "sysmon",
            "sysmon_event1",
            "windows"
          ]
        },
        "agent": {
          "id": "{{agent_id}}",
          "name": "{{agent_name}}",
          "ip": "10.1.0.20"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1700000000.628956771",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "1",
              "channel": "Microsoft-Windows-Sysmon/Operational",
              "providerName": "Microsoft-Windows-Sysmon",
              "computer": "{{hostname}}",
              "level": "4",
              "task": "1",
              "opcode": "0",
              "keywords": "0x8000000000000000",
              "severityValue": "INFORMATION"
            },
            "eventdata": {
              "utcTime": "{{utc_time}}",
              "processGuid": "{{guid}}",
              "processId": "{{pid}}",
              "image": "C:\\Windows\\System32\\sc.exe",
              "commandLine": "sc.exe stop WinDefend",
              "currentDirectory": "C:\\Windows\\System32\\",
              "user": "{{domain_upper}}\\{{username}}",
              "integrityLevel": "High",
              "hashes": "SHA256=3456789ABCDEF1234567890ABCDEF1234567890ABCDEF1234567890ABCDEF12",
              "parentProcessGuid": "{{parent_guid}}",
              "parentProcessId": "{{parent_pid}}",
              "parentImage": "C:\\Windows\\System32\\cmd.exe",
              "parentCommandLine": "cmd.exe"
            }
          }
        }
      }
    },
    {
      "_comment": "Windows Security Event 4688 - sc.exe process creation",
      "sequence": 8,
      "timestamp": "",
      "log": {
        "timestamp": "",
        "rule": {
          "level": 12,
          "description": "Sysmon - Event 4688: Disable Windows Defender",
          "id": "100100",
          "mitre": {
            "id": [
              "T1562.001"
            ],
            "tactic": [
              "Defense Evasion"
            ],
            "technique": [
              "Disable Windows Defender"
            ]
          },
          "firedtimes": 1,
          "mail": false,
          "groups": [
            "sysmon",
            "sysmon_event4688",
            "windows"
          ]
        },
        "agent": {
          "id": "{{agent_id}}",
          "name": "{{agent_name}}",
          "ip": "10.1.0.20"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1700000000.321755180",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "4688",
              "channel": "Security",
              "providerName": "Microsoft-Windows-Security-Auditing",
              "computer": "{{hostname}}",
              "level": "4",
              "task": "1",
              "opcode": "0",
              "keywords": "0x8000000000000000",
              "severityValue": "INFORMATION"
            },
            "eventdata": {
              "subjectUserSid": "S-1-5-21-1234567890-1234567890-1234567890-500",
              "subjectUserName": "{{username}}",
              "subjectDomainName": "{{domain_upper}}",
              "subjectLogonId": "0x3E7",
              "newProcessId": "0x{{pid_hex}}",
              "newProcessName": "C:\\Windows\\System32\\sc.exe",
              "tokenElevationType": "%%1937",
              "processId": "0x{{parent_pid_hex}}",
              "commandLine": "sc.exe stop WinDefend",
              "targetUserSid": "S-1-5-21-1234567890-1234567890-1234567890-500",
              "targetUserName": "{{username}}",
              "targetDomainName": "{{domain_upper}}",
              "targetLogonId": "0x3E7",
              "parentProcessName": "C:\\Windows\\System32\\cmd.exe",
              "mandatoryLabel": "S-1-16-12288"
            }
          }
        }
      }
    }
  ]
}