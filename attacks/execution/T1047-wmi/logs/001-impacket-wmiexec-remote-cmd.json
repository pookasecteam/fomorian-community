{
  "_metadata": {
    "attack_id": "T1047",
    "variation": "001",
    "name": "WMI Remote Command Execution - impacket-wmiexec",
    "description": "Attacker uses impacket-wmiexec to execute commands remotely via Windows Management Instrumentation (WMI), enabling lateral movement and remote code execution",
    "expected_detection": "HIGH",
    "kill_chain_phase": "execution",
    "format": "wazuh-native",
    "format_version": "1.0",
    "tool": "impacket-wmiexec",
    "command": "impacket-wmiexec yourcompany.local/Administrator:\"\"@10.1.0.99 \"whoami\"",
    "impact": "Remote code execution with SYSTEM privileges via WMI, enables lateral movement and persistence"
  },
  "logs": [
    {
      "_comment": "Sysmon Event 1 - WmiPrvSE.exe spawning cmd.exe (WMI execution indicator)",
      "sequence": 1,
      "timestamp": "2026-02-10T20:00:00.000Z",
      "log": {
        "timestamp": "2026-02-10T20:00:00.000Z",
        "rule": {
          "level": 12,
          "description": "Sysmon - Event 1: WMI Remote Command Execution",
          "id": "100100",
          "mitre": {
            "id": ["T1047"],
            "tactic": ["Execution"],
            "technique": ["Windows Management Instrumentation"]
          },
          "firedtimes": 1,
          "mail": false,
          "groups": ["sysmon", "sysmon_event1", "windows"]
        },
        "agent": {
          "id": "012",
          "name": "DC01",
          "ip": "10.1.0.99"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1707600000.100001",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "1",
              "channel": "Microsoft-Windows-Sysmon/Operational",
              "providerName": "Microsoft-Windows-Sysmon",
              "computer": "DC01.yourcompany.local",
              "level": "4",
              "task": "1",
              "severityValue": "INFORMATION"
            },
            "eventdata": {
              "utcTime": "2026-02-10 20:00:00.000",
              "processGuid": "{GUID-CMD}",
              "processId": "2456",
              "image": "C:\\Windows\\System32\\cmd.exe",
              "commandLine": "cmd.exe /Q /c whoami 1> \\\\127.0.0.1\\ADMIN$\\__1707600000.100001 2>&1",
              "currentDirectory": "C:\\Windows\\system32\\",
              "user": "NT AUTHORITY\\SYSTEM",
              "integrityLevel": "System",
              "hashes": "SHA256=D1C7B5E6F7C8D9E0F1A2B3C4D5E6F7A8B9C0D1E2F3A4B5C6D7E8F9A0B1C2D3E4",
              "parentProcessGuid": "{GUID-WMIPRVSE}",
              "parentProcessId": "1234",
              "parentImage": "C:\\Windows\\System32\\wbem\\WmiPrvSE.exe",
              "parentCommandLine": "C:\\Windows\\system32\\wbem\\wmiprvse.exe"
            }
          }
        }
      }
    },
    {
      "_comment": "Event 4688 - cmd.exe spawned by WmiPrvSE.exe (process creation audit)",
      "sequence": 2,
      "timestamp": "2026-02-10T20:00:01.000Z",
      "log": {
        "timestamp": "2026-02-10T20:00:01.000Z",
        "rule": {
          "level": 3,
          "description": "Windows Eventchannel event",
          "id": "60009",
          "firedtimes": 1,
          "mail": false,
          "groups": ["windows", "eventchannel"]
        },
        "agent": {
          "id": "012",
          "name": "DC01",
          "ip": "10.1.0.99"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1707600000.100002",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "4688",
              "channel": "Security",
              "providerName": "Microsoft-Windows-Security-Auditing",
              "computer": "DC01.yourcompany.local",
              "level": "0",
              "task": "13312",
              "keywords": "0x8020000000000000",
              "severityValue": "AUDIT_SUCCESS"
            },
            "eventdata": {
              "subjectUserSid": "S-1-5-18",
              "subjectUserName": "DC01$",
              "subjectDomainName": "YOURCOMPANY",
              "subjectLogonId": "0x3e7",
              "newProcessId": "0x998",
              "newProcessName": "C:\\Windows\\System32\\cmd.exe",
              "tokenElevationType": "%%1936",
              "processId": "0x4d2",
              "commandLine": "cmd.exe /Q /c whoami 1> \\\\127.0.0.1\\ADMIN$\\__1707600000.100001 2>&1",
              "creatorProcessName": "C:\\Windows\\System32\\wbem\\WmiPrvSE.exe"
            }
          }
        }
      }
    },
    {
      "_comment": "Event 5145 - Network share access for output retrieval (ADMIN$ access)",
      "sequence": 3,
      "timestamp": "2026-02-10T20:00:02.000Z",
      "log": {
        "timestamp": "2026-02-10T20:00:02.000Z",
        "rule": {
          "level": 3,
          "description": "Windows Eventchannel event",
          "id": "60009",
          "firedtimes": 1,
          "mail": false,
          "groups": ["windows", "eventchannel"]
        },
        "agent": {
          "id": "012",
          "name": "DC01",
          "ip": "10.1.0.99"
        },
        "manager": {
          "name": "wazuh.manager"
        },
        "id": "1707600000.100003",
        "decoder": {
          "name": "windows_eventchannel"
        },
        "location": "EventChannel",
        "data": {
          "win": {
            "system": {
              "eventID": "5145",
              "channel": "Security",
              "providerName": "Microsoft-Windows-Security-Auditing",
              "computer": "DC01.yourcompany.local",
              "level": "0",
              "task": "12811",
              "keywords": "0x8020000000000000",
              "severityValue": "AUDIT_SUCCESS"
            },
            "eventdata": {
              "subjectUserSid": "S-1-5-21-3298120035-3471069779-879265153-500",
              "subjectUserName": "Administrator",
              "subjectDomainName": "YOURCOMPANY",
              "subjectLogonId": "0x12345",
              "objectType": "File",
              "ipAddress": "10.1.0.50",
              "ipPort": "49152",
              "shareName": "\\\\*\\ADMIN$",
              "shareLocalPath": "\\??\\C:\\Windows",
              "relativePath": "\\__1707600000.100001",
              "accessMask": "0x1",
              "accessList": "%%4416"
            }
          }
        }
      }
    }
  ]
}
