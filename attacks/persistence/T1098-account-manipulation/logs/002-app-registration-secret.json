{
  "_metadata": {
    "attack_id": "T1098",
    "variation": "002",
    "name": "Azure AD App Registration Backdoor",
    "description": "Attacker adds secret to existing application for persistence",
    "expected_detection": "HIGH",
    "expected_soar": "persistence-detection",
    "kill_chain_phase": "persistence",
    "notes": "Application credential added for OAuth-based persistence",
    "format": "wazuh-native",
    "format_version": "1.0"
  },
  "logs": [
    {
      "_comment": "Application secret/credential added",
      "sequence": 1,
      "timestamp": "2026-01-29T16:10:00.000Z",
      "log": {
        "azure": {
          "auditlogs": {
            "time": "2026-01-29T16:10:00.000Z",
            "operationName": "Update application - Certificates and secrets management",
            "category": "ApplicationManagement",
            "resultType": "Success",
            "properties": {
              "id": "audit-guid-002",
              "activityDisplayName": "Update application - Certificates and secrets management",
              "activityDateTime": "2026-01-29T16:10:00.000Z",
              "initiatedBy": {
                "user": {
                  "displayName": "John Doe",
                  "userPrincipalName": "john.doe@corp.local",
                  "ipAddress": "185.220.101.45"
                }
              },
              "targetResources": [
                {
                  "id": "app-guid-001",
                  "displayName": "Corp-SharePoint-Integration",
                  "type": "Application",
                  "modifiedProperties": [
                    {
                      "displayName": "KeyDescription",
                      "newValue": "{ \"KeyIdentifier\": \"backdoor-key-guid\", \"KeyType\": \"Password\", \"KeyUsage\": \"Verify\", \"DisplayName\": \"API Access Key\" }"
                    }
                  ]
                }
              ]
            }
          }
        },
        "agent": {
          "name": "Azure-Sentinel",
          "id": "azure"
        }
      }
    },
    {
      "_comment": "Dangerous permissions granted to app",
      "sequence": 2,
      "timestamp": "2026-01-29T16:10:30.000Z",
      "log": {
        "azure": {
          "auditlogs": {
            "time": "2026-01-29T16:10:30.000Z",
            "operationName": "Add app role assignment grant to user",
            "category": "ApplicationManagement",
            "resultType": "Success",
            "properties": {
              "activityDisplayName": "Add delegated permission grant",
              "initiatedBy": {
                "user": {
                  "userPrincipalName": "john.doe@corp.local",
                  "ipAddress": "185.220.101.45"
                }
              },
              "targetResources": [
                {
                  "displayName": "Corp-SharePoint-Integration",
                  "modifiedProperties": [
                    {
                      "displayName": "DelegatedPermissionGrant.Scope",
                      "newValue": "Mail.ReadWrite Directory.Read.All User.Read.All"
                    }
                  ]
                }
              ]
            }
          }
        },
        "agent": {
          "name": "Azure-Sentinel",
          "id": "azure"
        }
      }
    }
  ]
}